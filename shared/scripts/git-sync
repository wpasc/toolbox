#!/usr/bin/env bash
# git-sync - Quick add/commit/pull/push for repos used like Dropbox
#
# Usage: git-sync [commit message]
#   Default message is "sync" if none provided.
#
# Flow:
#   1. git add -A
#   2. git commit -m "<message>" (skips if nothing to commit)
#   3. git pull --rebase
#   4. git push
#
# Setup (pick one):
#
#   Option A - Add to PATH (recommended):
#     Add this to your .zshrc:
#       export PATH="$HOME/workspace/toolbox/shared/scripts:$PATH"
#     Then it works as both `git-sync` and `git sync` (git auto-discovers
#     commands named git-<foo> on PATH as subcommands).
#
# Dependencies: git

set -euo pipefail

if ! git rev-parse --is-inside-work-tree &>/dev/null; then
  echo "error: not a git repository" >&2
  exit 1
fi

msg="${*:-sync}"

git add -A

if git diff --cached --quiet; then
  echo "nothing to commit"
else
  git commit -m "$msg"
fi

git pull --rebase
git push
